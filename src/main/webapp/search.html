
<html>
    <head>
        <title>Vendify Dashboard</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <link rel="icon" href="img/favicon.png">
        <link rel="stylesheet" type="text/css" href="css/search.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

        <script>
            function loadUsername() {
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function () {
                    if (this.readyState == 4 && this.status == 200) {
                        document.getElementById("username").innerText = this.responseText;
                    }
                };
                xhr.open("GET", "userLogin", true);
                xhr.send();
            }
           
            
            
            window.onload = function () {
                      
                        loadUsername();
                    };

        </script>
    </head>
    <body>
        
        <div class="dashboard">
            <div class="navbar">
                <img src="img/favicon.png" alt= "fotito" style="height:45px;">
                <a href="home.html"><i class="fa fa-home"></i> Home</a>
                <a href="login.html"><i class="fa fa-sign-in-alt"></i> Login</a>
                <a href="register.html"><i class="fa fa-user-plus"></i> Register</a>
                <a href="adminLogin.html"><i class="fa fa-address-book"></i> Administrador</a>
            </div>
            
            <div class="menu-vertical">
                <div class="user-photo">
                    <img src="img/user.png" alt="fotito">
                </div>
                <ul>
                    <li class=" welcome-user"><span id="username"></span></li>
                    <li><a href="reservas.html"><i class="far fa-calendar-alt"></i> Tus reservas</a></li>
                    <li><a href="userdashboard.html"><i class="fa fa-user"></i> Cuenta</a></li>
                    <li><a href="search.html"><i class="fa fa-search"></i> Buscar</a></li>
                    <li><a href="login.html"><i class="fa fa-sign-out-alt"></i> Salir</a></li>

                </ul>
            </div>
            
         
        </div>
        
        <script>
        function searchProducto(product_id) {
            var resultadosDiv = document.getElementById("resultados");

            // Realizar una solicitud AJAX al servlet para buscar productos
            var xhr = new XMLHttpRequest();
            xhr.open("GET", `http://localhost:8080/Vendify/searchProducto?nombre_producto=${product_id}`, true);

            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        // Crear una tabla y agregarla al div de resultados
                        var tabla = document.createElement("table");
                        tabla.border = "1";

                        // Cabecera de la tabla
                        var cabecera = tabla.createTHead();
                        var filaCabecera = cabecera.insertRow();
                        var th1 = filaCabecera.insertCell(0);
                        var th2 = filaCabecera.insertCell(1);
                        var th3 = filaCabecera.insertCell(2);
                        var th4 = filaCabecera.insertCell(3);
                        th1.innerHTML = "Nombre";
                        th2.innerHTML = "Descripción";
                        th3.innerHTML = "Localización";
                        th4.innerHTML = "Precio";

                        // Cuerpo de la tabla
                        var cuerpo = tabla.createTBody();

                        // Suponiendo que el servidor devuelve un JSON array de productos
                        try {
                            var productos = JSON.parse(xhr.responseText);
                            productos.forEach(function(producto) {
                                var fila = cuerpo.insertRow();
                                var celdaNombre = fila.insertCell(0);
                                        var celdaDescripcion = fila.insertCell(1);
                                        var celdaLocalizacion = fila.insertCell(2);
                                        var celdaPrecio = fila.insertCell(3);
                                        celdaNombre.innerHTML = producto.nombre_producto;
                                        celdaDescripcion.innerHTML = producto.descripcion;
                                        celdaLocalizacion.innerHTML = producto.localizacion;
                                        celdaPrecio.innerHTML = producto.precio;
                                    });
                                } catch (e) {
                                    resultadosDiv.innerHTML = "Error al procesar la respuesta del servidor.";
                                    console.error("Error al procesar JSON: " + e);
                                    return;
                                }

                                // Limpiar el div de resultados y agregar la tabla
                                resultadosDiv.innerHTML = "";
                                resultadosDiv.appendChild(tabla);
                            } else {
                                console.error("Error en la solicitud: " + xhr.status + " - " + xhr.statusText);
                                resultadosDiv.innerHTML = "Error en la solicitud. Por favor, inténtelo de nuevo más tarde.";
                            }
                        }
                    };
                    xhr.send();
                }
        </script>
       
        <div class="centered-container">
            <h2>Búsqueda de Parkings On-line</h2>
            <form> 
                <input type="text" id="searchQuery" name="query" placeholder="Buscar parkings...">
                <input id="boton-editar" type="button" value="Buscar" onclick="searchProducto(document.getElementById('searchQuery').value)">
            </form>
            <div id="resultados"></div>
        </div>
        
        <ul class="circles">
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
        </ul>

    </body>
</html>
